{% include "include_this.html" %}
<h2 >Update Inventory</h2>
<form method="POST">
    {{fillingform.branchArea(id='branchArea', onchange="getBranchUnitNames()")}}
    {{fillingform.branchOutletOrNot(id='branchOutletOrNot', onchange="getBranchUnitNames()")}}
    {{fillingform.branchUnitName(id='branchUnitName')}}
    {{fillingform.addOrRemove(id='addOrRemove', onchange="makeVisible()")}}
    {{fillingform.expiryDate(placeholder='Expiry Date dd/mm/yyyy', id='expiry')}}
    {{fillingform.removeReason(placeholder="Reason", id='removeReason')}}
    <br>
    {{fillingform.existingItemName(id = "existingItemName", onchange="makeVisible()") }}
    {{fillingform.newItemBarCode(placeholder="New Item Bar Code", id="newItemBarCode")}}
    {{fillingform.itemName(placeholder="Update Item Name ", id="itemName")}}
    {{fillingform.updatePrice(placeholder=" Update Price", id='updatePrice')}}
    <b> Quantity </b>{{fillingform.itemQuantity(placeholder="Add/Remove Quantity")}}
    {{fillingform.submit(id='submit', onclick="setDefaults()")}}
</form>
<h6> {{ error }}</h6>

<script>
window.onload = function init() {
    if(localStorage.getItem('branchArea'))
    {
        document.getElementById("branchArea").options[localStorage.getItem('branchArea')].selected = true;
    }
    if(localStorage.getItem('branchOutletOrNot'))
    {
        document.getElementById("branchOutletOrNot").options[localStorage.getItem('branchOutletOrNot')].selected = true;
    }
    if(localStorage.getItem('addOrRemove'))
    {
        document.getElementById("addOrRemove").options[localStorage.getItem('addOrRemove')].selected = true;
    }
    makeVisible();
    getBranchUnitNames();
}

function setDefaults(){
    let x = document.getElementById("branchArea");
    let y = document.getElementById("branchOutletOrNot");
    let z = document.getElementById("branchUnitName");
    let a = document.getElementById("addOrRemove");

    localStorage.setItem("branchArea", x.selectedIndex);
    localStorage.setItem("branchOutletOrNot", y.selectedIndex);
    localStorage.setItem("branchUnitName", z.selectedIndex);
    localStorage.setItem("addOrRemove", a.selectedIndex);
}

function makeVisible() {
    newItemBarCode = document.getElementById("newItemBarCode");
    existingItemName = document.getElementById("existingItemName");
    addOrRemove = document.getElementById("addOrRemove");
    expiry = document.getElementById("expiry");
    itemName = document.getElementById("itemName");
    updatePrice = document.getElementById("updatePrice");
    removeReason = document.getElementById("removeReason");

    removeReason.style.display = 'none';
    removeReason.value = 'Expiry';
    expiry.style.display = '';
    itemName.style.display = '';
    updatePrice.style.display = '';
    newItemBarCode.style.display = '';

    if(existingItemName.value != 0) {
        newItemBarCode.style.display = 'none';
    }
    else {
        newItemBarCode.style.display = '';
    }
    if(addOrRemove.value == 1) {
        removeReason.style.display = '';
        removeReason.value = '';
        expiry.style.display = 'none';
        newItemBarCode.style.display = 'none';
        itemName.style.display = 'none';
        updatePrice.style.display = 'none';
    }
}


function getBranchUnitNames() {
    let x = document.getElementById("branchArea");
    let y = document.getElementById("branchOutletOrNot");
    let z = document.getElementById("branchUnitName");
    branchArea = x.value;
    branchOutletOrNot = y.value;
    z.innerHTML = "";
    fetch('/branchUnitName/'+ branchArea + '/' + branchOutletOrNot).then(function(response){
       response.json().then(function(data){
           let optionHtml = '';
           for(let branchUnitName of data.branchUnitNames) {
               var opt = document.createElement('option');
               opt.innerHTML = branchUnitName.id;
               opt.value = branchUnitName.name;
               z.appendChild(opt);
           }
           z.options[localStorage.getItem('branchUnitName')].selected = true;
       });
    });
}


// $(document).ready(function() {
//     $('#existingItemName').select2({
//     placeholder: "{{ fillingform.existingItemName.label.text }}",
//     allowClear: true,
//     "width": "style"
// });
// });
// $(document).ready(function() {
//     $('#branchArea').select2({
//     placeholder: "{{ fillingform.branchArea.label.text }}",
//     allowClear: true,
//     "width": "style"
// });
// });
</script>
